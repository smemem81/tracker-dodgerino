<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dodge Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Righteous', 'sans-serif'],
                    },
                    colors: {
                        'dark-bg': '#0A0A0A',
                        'dark-card': '#1C1C1C',
                        'dark-border': '#2C2C2C',
                        'dark-text-primary': '#F0F0F0',
                        'dark-text-secondary': '#888888',
                        
                        'brand-blue': '#007BFF',
                        'brand-red': '#E53E3E',
                        'brand-green': '#22C55E',
                        'brand-yellow': '#FACC15',
                    },
                    borderRadius: {
                        'none': '0px', 'sm': '0px', 'DEFAULT': '0px', 'md': '0px',
                        'lg': '0px', 'xl': '0px', '2xl': '0px', '3xl': '0px', 'full': '0px',
                    }
                },
            },
        };
    </script>
    
    <style>
        /* Status Color Classes */
        .status-text.IN_GAME { color: #007BFF; }
        .status-text.HIGH_RISK { color: #E53E3E; }
        .status-text.LOW_RISK { color: #22C55E; }
        .status-text.ERROR { color: #FACC15; }
        .status-text.IDLE { color: #888888; }
        .status-text.CHECKING { color: #888888; }
        
        /* Ban Status Classes */
        .ban-status.BANNED { color: #E53E3E; }
        .ban-status.NOT_BANNED { color: #22C55E; }
        .ban-status.IDLE { color: #888888; }

        /* Hover and Modal styles */
        .player-item:hover .delete-btn { opacity: 1; }
        #modal-overlay { visibility: hidden; opacity: 0; transition: opacity 0.2s ease-in-out; }
        #modal-overlay.visible { visibility: visible; opacity: 1; }
        #modal-content { transform: translateY(20px); transition: transform 0.2s ease-in-out; max-width: 600px; }
        #modal-overlay.visible #modal-content { transform: translateY(0); }
    </style>
</head>
<body class="bg-dark-bg text-dark-text-primary font-sans p-4 md:p-8">

    <div class="max-w-xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-white mb-6 tracking-wide uppercase">Dodge Tool</h1>
        <div class="bg-dark-card border border-dark-border mb-3">
            <div class="flex flex-col sm:flex-row gap-3 p-4">
                <input type="text" id="gameNameInput" class="flex-grow w-full p-3 bg-dark-bg border border-dark-border text-dark-text-primary placeholder-dark-text-secondary focus:outline-none focus:ring-2 focus:ring-brand-blue" placeholder="Game Name">
                <input type="text" id="tagLineInput" class="w-full sm:w-28 p-3 bg-dark-bg border border-dark-border text-dark-text-primary placeholder-dark-text-secondary focus:outline-none focus:ring-2 focus:ring-brand-blue" placeholder="#KR1">
                <select id="regionSelect" class="w-full sm:w-auto p-3 bg-dark-bg border border-dark-border text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-blue">
                    <option value="KR">KR</option><option value="EUW1">EUW</option><option value="NA1">NA</option><option value="EUN1">EUNE</option><option value="BR1">BR</option><option value="JP1">JP</option><option value="LA1">LAN</option><option value="LA2">LAS</option><option value="OC1">OCE</option><option value="TR1">TR</option><option value="RU">RU</option>
                </select>
                <button id="addPlayerButton" class="w-full sm:w-auto px-5 py-3 bg-brand-blue text-white font-semibold transition-all duration-200 ease-in-out hover:bg-brand-yellow hover:text-dark-bg focus:outline-none uppercase tracking-wider">
                    Add
                </button>
            </div>
        </div>
        <div class="bg-dark-card border border-dark-border mb-6 p-4">
             <label for="champToTrackInput" class="block text-sm font-medium text-dark-text-secondary mb-2">CHAMPION TO TRACK BANS FOR</label>
             <input type="text" id="champToTrackInput" class="w-full p-3 bg-dark-bg border border-dark-border text-dark-text-primary placeholder-dark-text-secondary focus:outline-none focus:ring-2 focus:ring-brand-blue" placeholder="e.g., Katarina">
        </div>
        <div id="playerListContainer" class="bg-dark-card border border-dark-border">
            <div class="flex justify-between items-center p-4 border-b border-dark-border">
                <h2 class="text-lg font-semibold text-white uppercase tracking-wider">Tracking List</h2>
                <span id="playerCount" class="text-sm text-dark-text-secondary">0 players</span>
            </div>
            <div id="playerList" class="divide-y divide-dark-border">
                <p id="emptyMessage" class="text-center text-dark-text-secondary p-6">Add players to begin tracking.</p>
            </div>
            <div class="p-4 border-t border-dark-border">
                <div id="summaryMessage" class="p-3 mb-4 font-bold text-md text-center bg-dark-bg border border-dark-border text-dark-text-secondary">
                    Click "Refresh All" to check statuses.
                </div>
                <button id="refreshButton" class="w-full py-4 px-6 bg-brand-blue text-white text-lg font-semibold transition-all duration-200 ease-in-out hover:bg-brand-yellow hover:text-dark-bg focus:outline-none disabled:bg-dark-border disabled:text-dark-text-secondary disabled:cursor-not-allowed uppercase tracking-wider">
                    REFRESH ALL
                </button>
            </div>
        </div>
    </div>
    
    <div id="modal-overlay" class="fixed inset-0 bg-dark-bg bg-opacity-80 flex items-center justify-center p-4">
        <div id="modal-content" class="bg-dark-card border border-dark-border w-full">
            <div class="flex justify-between items-center p-4 border-b border-dark-border">
                <h3 id="modalTitle" class="text-lg font-semibold uppercase tracking-wider">Last Match Details</h3>
                <button id="modalCloseButton" class="text-dark-text-secondary hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="p-6">
                <div class="flex items-center gap-3 mb-4">
                    <img id="modalPlayerIcon" src="https://placehold.co/64x64/1C1C1C/888888?text=?" alt="Player Icon" class="w-16 h-16 border-2 border-dark-border">
                    <div>
                        <h4 id="modalPlayerName" class="text-xl font-bold text-white">Player Name</h4>
                        <span id="modalPlayerTag" class="text-md text-dark-text-secondary">#TAG</span>
                    </div>
                </div>
                <div id="modalGameTimeSection" class="hidden text-center text-dark-text-secondary text-sm font-semibold mb-2">
                    (Game ended 3m ago)
                </div>
                <div id="modalResultSection" class="mb-4 text-center">
                    <span id="modalMatchResult" class="text-2xl font-bold text-brand-green">VICTORY</span>
                </div>
                <div id="modalKDASection" class="flex items-center gap-3 bg-dark-bg p-3 border border-dark-border mb-4">
                    <img id="modalChampIcon" src="https://placehold.co/40x40/0A0A0A/888888?text=?" alt="Champ Icon" class="w-10 h-10 border-2 border-dark-border">
                    <div>
                        <div id="modalChampName" class="font-semibold text-white">Champion Name</div>
                        <div id="modalKDA" class="text-sm text-dark-text-secondary">K/D/A</div>
                    </div>
                </div>
                <div id="modalLiveGameSection" class="hidden p-3 mb-4 font-bold text-md text-center bg-brand-blue/10 border border-brand-blue text-brand-blue uppercase">
                    LIVE GAME (16:32 elapsed)
                </div>
                <div class="grid grid-cols-2 gap-4 **sm:grid-cols-1 md:grid-cols-2**">
                    <div class="bg-dark-bg p-3 border border-dark-border">
                        <h4 class="text-lg font-bold text-brand-blue mb-3 text-center uppercase">BLUE SIDE</h4>
                        <div class="mb-3">
                            <h5 class="text-sm text-dark-text-secondary mb-2 uppercase tracking-wider">Bans</h5>
                            <div id="modalBlueBans" class="flex flex-wrap gap-1.5 justify-center"></div>
                        </div>
                        <div>
                            <h5 class="text-sm text-dark-text-secondary mb-2 uppercase tracking-wider">Participants</h5>
                            <div id="modalBlueParticipants" class="flex flex-col gap-2"></div>
                        </div>
                    </div>
                    <div class="bg-dark-bg p-3 border border-dark-border">
                        <h4 class="text-lg font-bold text-brand-red mb-3 text-center uppercase">RED SIDE</h4>
                        <div class="mb-3">
                            <h5 class="text-sm text-dark-text-secondary mb-2 uppercase tracking-wider">Bans</h5>
                            <div id="modalRedBans" class="flex flex-wrap gap-1.5 justify-center"></div>
                        </div>
                        <div>
                            <h5 class="text-sm text-dark-text-secondary mb-2 uppercase tracking-wider">Participants</h5>
                            <div id="modalRedParticipants" class="flex flex-col gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        // Vercel uses a relative path to the /api/index.js route
        const BACKEND_URL = ''; 
        let LATEST_PATCH = '15.21.1';
        let DD_URL = `https://ddragon.leagueoflegends.com/cdn/${LATEST_PATCH}`;

        // --- STATE & DOM ELEMENTS ---
        let players = []; 
        let isChecking = false; 
        
        const addPlayerButton = document.getElementById('addPlayerButton');
        const gameNameInput = document.getElementById('gameNameInput');
        const tagLineInput = document.getElementById('tagLineInput');
        const regionSelect = document.getElementById('regionSelect');
        const champToTrackInput = document.getElementById('champToTrackInput');
        const playerListDiv = document.getElementById('playerList');
        const emptyMessage = document.getElementById('emptyMessage');
        const playerCount = document.getElementById('playerCount');
        const refreshButton = document.getElementById('refreshButton');
        const summaryMessage = document.getElementById('summaryMessage');

        const modalOverlay = document.getElementById('modal-overlay');
        const modalCloseButton = document.getElementById('modalCloseButton');
        const modalTitle = document.getElementById('modalTitle');
        const modalPlayerIcon = document.getElementById('modalPlayerIcon');
        const modalPlayerName = document.getElementById('modalPlayerName');
        const modalPlayerTag = document.getElementById('modalPlayerTag');
        const modalGameTimeSection = document.getElementById('modalGameTimeSection'); 
        const modalResultSection = document.getElementById('modalResultSection');
        const modalKDASection = document.getElementById('modalKDASection');
        const modalLiveGameSection = document.getElementById('modalLiveGameSection');
        const modalMatchResult = document.getElementById('modalMatchResult');
        const modalChampIcon = document.getElementById('modalChampIcon');
        const modalChampName = document.getElementById('modalChampName');
        const modalKDA = document.getElementById('modalKDA');
        const modalBlueBans = document.getElementById('modalBlueBans');
        const modalBlueParticipants = document.getElementById('modalBlueParticipants');
        const modalRedBans = document.getElementById('modalRedBans');
        const modalRedParticipants = document.getElementById('modalRedParticipants');


        // --- CORE FUNCTIONS ---
        function addPlayer() {
            const gameName = gameNameInput.value.trim();
            const tagLine = tagLineInput.value.trim();
            const region = regionSelect.value;
            
            if (!gameName || !tagLine) {
                alert("Please enter both a Game Name and a Tagline.");
                return;
            }
            
            const cleanTagLine = tagLine.startsWith('#') ? tagLine : `#${tagLine}`;
            const playerId = `${region.toLowerCase()}-${gameName.toLowerCase()}-${cleanTagLine.toLowerCase()}`;
            const exists = players.some(p => p.id === playerId);

            if (exists) {
                alert("This player is already on the list.");
                return;
            }

            players.push({ 
                id: playerId, region: region, gameName: gameName, tagLine: cleanTagLine,
                profileIconUrl: `https://placehold.co/40x40/1C1C1C/888888?text=?`,
                status: 'IDLE', statusMessage: 'Idle', isChampBanned: null,
                lastMatchDetails: null, liveGameDetails: null
            });
            
            gameNameInput.value = '';
            tagLineInput.value = '';
            renderPlayerList();
        }
        
        function removePlayer(playerId) {
            players = players.filter(p => p.id !== playerId);
            renderPlayerList();
        }

        function renderPlayerList() {
            playerListDiv.innerHTML = '';
            
            if (players.length === 0) {
                playerListDiv.appendChild(emptyMessage);
            } else {
                players.forEach(player => {
                    const item = document.createElement('div');
                    item.className = 'player-item flex justify-between items-center p-3 border-l-4 border-l-dark-border transition-all cursor-pointer hover:bg-dark-border/50';
                    item.setAttribute('data-player-item-id', player.id); 
                    
                    item.classList.remove('border-l-dark-border', 'border-l-brand-red', 'border-l-brand-blue', 'border-l-brand-green', 'border-l-brand-yellow');
                    if (player.status === 'HIGH_RISK') item.classList.add('border-l-brand-red');
                    else if (player.status === 'IN_GAME') item.classList.add('border-l-brand-blue');
                    else if (player.status === 'LOW_RISK') item.classList.add('border-l-brand-green');
                    else if (player.status === 'ERROR') item.classList.add('border-l-brand-yellow');
                    else item.classList.add('border-l-dark-border');
                    
                    const champToTrack = champToTrackInput.value.trim() || 'Katarina';
                    let banStatusText = '---';
                    let banStatusClass = 'IDLE';
                    if (player.isChampBanned === true) {
                        banStatusText = `${champToTrack}: BANNED`;
                        banStatusClass = 'BANNED';
                    } else if (player.isChampBanned === false) {
                        banStatusText = `${champToTrack}: NOT BANNED`;
                        banStatusClass = 'NOT_BANNED';
                    } else if (player.status === 'CHECKING') {
                        banStatusText = 'Checking...';
                        banStatusClass = 'IDLE';
                    }

                    item.innerHTML = `
                        <div class="flex items-center gap-3">
                            <img src="${player.profileIconUrl}" alt="icon" class="w-10 h-10 border-2 border-dark-border">
                            <div class="flex flex-col">
                                <span class="text-dark-text-primary font-medium">${player.gameName} <span class="text-dark-text-secondary">${player.tagLine}</span></span>
                                <span class="text-xs text-dark-text-secondary font-sans font-normal">${player.region}</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="flex flex-col text-right">
                                <span class="status-text ${player.status} text-sm font-semibold" data-status-id="${player.id}">
                                    ${player.statusMessage}
                                </span>
                                <span class="ban-status ${banStatusClass} text-xs font-semibold" data-ban-id="${player.id}">
                                    ${banStatusText}
                                </span>
                            </div>
                            <button class="delete-btn opacity-0 text-dark-text-secondary hover:text-brand-red transition-opacity z-10 p-2" data-remove-id="${player.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </div>
                    `;
                    const img = item.querySelector('img');
                    img.onerror = () => { img.src = 'https://placehold.co/40x40/1C1C1C/888888?text=?'; };

                    playerListDiv.appendChild(item);
                });
            }
            playerCount.innerText = `${players.length} players`;
        }
        
        async function handleRefresh() {
            if (players.length === 0) {
                alert("Add some players to the list first.");
                return;
            }
            if (isChecking) {
                return;
            }

            isChecking = true;
            const champToTrack = champToTrackInput.value.trim() || 'Katarina';
            disableButton(120); 
            
            summaryMessage.className = 'p-3 mb-4 font-bold text-md text-center bg-dark-bg border border-dark-border text-blue-400';
            summaryMessage.innerText = 'Checking players 1 by 1 (to avoid rate limits)...';

            players.forEach(p => { 
                p.status = 'CHECKING'; p.statusMessage = 'Checking...'; p.isChampBanned = null;
            });
            renderPlayerList();

            try {
                // The URL is now the Vercel API path (e.g., /check-status)
                const response = await fetch('/check-status', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        players: players.map(p => ({ id: p.id, region: p.region, gameName: p.gameName, tagLine: p.tagLine.substring(1) })),
                        champToTrack: champToTrack
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.statusText}`);
                }

                const statuses = await response.json();
                
                statuses.forEach(statusUpdate => {
                    const player = players.find(p => p.id === statusUpdate.id);
                    if (player) {
                        player.status = statusUpdate.status || 'ERROR';
                        player.statusMessage = statusUpdate.statusMessage || 'Error';
                        player.isChampBanned = statusUpdate.isChampBanned;
                        player.profileIconUrl = statusUpdate.profileIconUrl || 'https://placehold.co/40x40/1C1C1C/888888?text=?';
                        player.lastMatchDetails = statusUpdate.lastMatchDetails;
                        player.liveGameDetails = statusUpdate.liveGameDetails;
                    }
                });
                
                const highRisk = players.some(s => s.status === 'HIGH_RISK' || s.status === 'IN_GAME');
                if (highRisk) {
                    summaryMessage.className = 'p-3 mb-4 font-bold text-md text-center bg-brand-red/10 border border-brand-red text-brand-red uppercase';
                    summaryMessage.innerText = 'ðŸ”´ DO NOT QUEUE ðŸ”´';
                } else {
                    summaryMessage.className = 'p-3 mb-4 font-bold text-md text-center bg-brand-green/10 border border-brand-green text-brand-green uppercase';
                    summaryMessage.innerText = 'ðŸŸ¢ SAFE TO QUEUE ðŸŸ¢';
                }
                
                renderPlayerList();

            } catch (error) {
                console.error(error);
                summaryMessage.className = 'p-3 mb-4 font-bold text-md text-center bg-dark-bg border border-dark-border text-brand-red';
                summaryMessage.innerText = 'Error connecting to server. Check logs/API key.';
            }
            
            isChecking = false;
        }

        function disableButton(seconds) {
            refreshButton.disabled = true;
            let countdown = seconds;
            refreshButton.innerText = `On Cooldown (${countdown}s)`;

            const interval = setInterval(() => {
                countdown--;
                if (countdown > 0 && isChecking) {
                    refreshButton.innerText = 'Checking...';
                } else if (countdown > 0 && !isChecking) {
                    refreshButton.innerText = `On Cooldown (${countdown}s)`;
                } else {
                    clearInterval(interval);
                    refreshButton.disabled = false;
                    refreshButton.innerText = 'REFRESH ALL';
                }
            }, 1000);
        }

        // --- MODAL FUNCTIONS ---
        function createBanIcon(champName) {
            if (!champName) champName = "Unknown";
            const banIcon = document.createElement('img');
            banIcon.src = `${DD_URL}/img/champion/${champName}.png`;
            banIcon.alt = champName;
            banIcon.title = champName;
            banIcon.className = 'w-8 h-8 border border-dark-border';
            banIcon.onerror = () => { banIcon.src = 'https://placehold.co/32x32/1C1C1C/888888?text=?'; };
            return banIcon;
        }

        function createParticipantItem(participant) {
            const participantItem = document.createElement('div');
            participantItem.className = 'flex items-center gap-2 bg-dark-bg p-2 border border-dark-border';
            
            participantItem.innerHTML = `
                <img src="${DD_URL}/img/champion/${participant.championPlayed}.png" alt="${participant.championPlayed}" class="w-8 h-8 border border-dark-border">
                <span class="text-sm text-white">${participant.gameName} <span class="text-dark-text-secondary">${participant.tagLine}</span></span>
            `;
            
            const img = participantItem.querySelector('img');
            img.onerror = () => { img.src = 'https://placehold.co/32x32/0A0A0A/888888?text=?'; };
            return participantItem;
        }
        
        function showModal(playerId) {
            const player = players.find(p => p.id === playerId);
            
            if (!player || (!player.lastMatchDetails && !player.liveGameDetails)) {
                alert("No match details found. Click 'Refresh All' first.");
                return;
            }

            modalPlayerIcon.src = player.profileIconUrl;
            modalPlayerIcon.onerror = () => { modalPlayerIcon.src = 'https://placehold.co/64x64/1C1C1C/888888?text=?'; };
            modalPlayerName.innerText = player.gameName;
            modalPlayerTag.innerText = player.tagLine;

            let details;
            if (player.status === 'IN_GAME' && player.liveGameDetails) {
                details = player.liveGameDetails;
                modalTitle.innerText = "Live Game Details";
                
                modalGameTimeSection.classList.add('hidden'); 
                modalResultSection.classList.add('hidden');
                modalKDASection.classList.add('hidden');
                modalLiveGameSection.classList.remove('hidden');
                
                const elapsedSeconds = Math.floor((Date.now() - details.gameStartTime) / 1000);
                modalLiveGameSection.innerText = `LIVE GAME (${Math.floor(elapsedSeconds / 60)}:${String(elapsedSeconds % 60).padStart(2, '0')} elapsed)`;

            } else if (player.lastMatchDetails) {
                details = player.lastMatchDetails;
                modalTitle.innerText = "Last Match Details";
                
                modalGameTimeSection.classList.remove('hidden'); 
                modalResultSection.classList.remove('hidden');
                modalKDASection.classList.remove('hidden');
                modalLiveGameSection.classList.add('hidden');

                modalGameTimeSection.innerText = `(${player.statusMessage})`;
                if (player.status === 'HIGH_RISK') modalGameTimeSection.className = 'text-center text-brand-red text-sm font-semibold mb-2';
                else modalGameTimeSection.className = 'text-center text-brand-green text-sm font-semibold mb-2';

                if (details.win) {
                    modalMatchResult.innerText = 'VICTORY';
                    modalMatchResult.className = 'text-2xl font-bold text-brand-green text-center';
                } else {
                    modalMatchResult.innerText = 'DEFEAT';
                    modalMatchResult.className = 'text-2xl font-bold text-brand-red text-center';
                }
                
                modalChampIcon.src = `${DD_URL}/img/champion/${details.championPlayed}.png`;
                modalChampIcon.onerror = () => { modalChampIcon.src = 'https://placehold.co/40x40/0A0A0A/888888?text=?'; };
                modalChampName.innerText = details.championPlayed;
                modalKDA.innerText = details.kda;
                
            } else {
                alert("An error occurred. No details to show.");
                return;
            }

            modalBlueBans.innerHTML = '';
            modalRedBans.innerHTML = '';
            modalBlueParticipants.innerHTML = '';
            modalRedParticipants.innerHTML = '';

            // FIXED: Only add bans and participants from the correct team arrays (details.team1Bans, details.team2Bans, etc.)
            (details.team1Bans || []).forEach(ban => modalBlueBans.appendChild(createBanIcon(ban)));
            (details.team2Bans || []).forEach(ban => modalRedBans.appendChild(createBanIcon(ban)));
            (details.team1 || []).forEach(p => modalBlueParticipants.appendChild(createParticipantItem(p)));
            (details.team2 || []).forEach(p => modalRedParticipants.appendChild(createParticipantItem(p)));
            
            modalOverlay.classList.add('visible');
        }
        
        function hideModal() {
            modalOverlay.classList.remove('visible');
        }

        // --- EVENT LISTENERS ---
        addPlayerButton.addEventListener('click', addPlayer);
        gameNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (tagLineInput.value.trim() === '') tagLineInput.focus();
                else addPlayer();
            }
        });
        tagLineInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addPlayer();
        });

        refreshButton.addEventListener('click', handleRefresh);

        playerListDiv.addEventListener('click', (e) => {
            const deleteButton = e.target.closest('.delete-btn');
            if (deleteButton) {
                e.stopPropagation(); 
                const playerId = deleteButton.dataset.removeId;
                removePlayer(playerId);
            } else {
                const playerItem = e.target.closest('.player-item');
                if (playerItem) {
                    const playerId = playerItem.dataset.playerItemId;
                    showModal(playerId);
                }
            }
        });
        
        modalCloseButton.addEventListener('click', hideModal);
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                hideModal();
            }
        });

        renderPlayerList();
        hideModal(); 
    </script>
</body>
</html>